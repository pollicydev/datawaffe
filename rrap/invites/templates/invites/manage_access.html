{% extends "base.html" %}

{% load crispy_forms_filters i18n tiet_invites static %}

{% block title %}{% trans "Manage access" %} Â· {{ organisation.title }}{% endblock %}

{% block content %}

<header class="page-title-bar">
  <h1 class="page-title"> Invite your teammates to collaborate </h1>
</header>

<div class="page-section">
  <div class="section-block">
    <div class="card card-fluid">
      <div class="card-body">
        <form action="" method="post">
          {% csrf_token %}
          {{ form|crispy }}
          <button type="submit" class="btn btn-success">{% trans "Send invitation" %}</button>
        </form>
      </div>
    </div>
    <h1 class="page-title mt-5 mb-3"> Pending invitations </h1>
    <div class="card">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>{% trans "Invitee" %}</th>
              <th>{% trans "Date sent" %}</th>
              <th>{% trans "Invited by" %}</th>
              <th>{% trans "Status" %}</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for invite in invites %}
            <tr>
              <td class="align-middle text-truncate">{{ invite.get_invitee_email }}</td>
              <td class="align-middle">{{ invite.date_sent|date:"SHORT_DATETIME_FORMAT" }}</td>
              <td class="align-middle">{{ invite.invited_by.profile }}</td>
              <td class="align-middle">{% invite_status invite %}</td>
              <td class="align-middle text-right">
                {% if invite.is_pending %}
                <div class="dropdown">
                  <button type="button" class="btn btn-sm btn-icon btn-secondary" data-toggle="dropdown"
                    aria-expanded="true" aria-haspopup="true"><i class="fa fa-ellipsis-h"></i> <span
                      class="sr-only">Actions</span></button>
                  <div class="dropdown-menu dropdown-menu-right" x-placement="bottom-end"
                    style="position: absolute; top: 29px; left: -125px; will-change: top, left;">
                    <div class="dropdown-arrow mr-n1"></div>
                    <button class="dropdown-item" type="button"
                      onclick="location.href='{{ invite.get_absolute_url }}'">Copy link</button>
                    <button class="dropdown-item"
                      onclick="location.href='{% url "invites:invite_delete" organisation.owner.username organisation.name invite.pk %}'"
                      type="button">Delete</button>
                  </div>
                </div>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{% endblock content %}
