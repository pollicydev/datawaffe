{% load static i18n compress user_extras %}
<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>{% block title %}Rapid Research for Agile Policymaking{% endblock title %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Rapid Research for Agile Policymaking">
    <meta name="author" content="Matchstick Studio">

    <link rel="icon" href="{% static 'images/favicons/favicon.ico' %}">

    {% block css %}
    {% compress css %}
    <link rel="stylesheet" type="text/css" href="{% static 'lib/material-design-icons/css/material-design-iconic-font.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'lib/perfect-scrollbar/css/perfect-scrollbar.css' %}">
    {% block stylesheet %}{% endblock %}
    <link href="{% static 'css/app.css' %}" rel="stylesheet">
    {% endcompress %}
    {% endblock %}

    {% compress js %}
    <script src="{% static 'lib/jquery/jquery.min.js' %}" type="text/javascript"></script>				
    <script src="{% static 'lib/perfect-scrollbar/js/perfect-scrollbar.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'lib/bootstrap/dist/js/bootstrap.bundle.min.js' %}" type="text/javascript"></script>
    <script defer src="{% static 'js/app.js' %}"></script>
    {% block javascript %}{% endblock javascript %}
    <script type="text/javascript">
      $(document).ready(function(){
        //initialize the javascript
        App.init();
      });

      // dissappears alerts after 3s
      setTimeout(function(){
        $('.alert').fadeTo("slow", 0.1, function(){
            $('.alert').alert('close')
        });     
        }, 3000)
    </script>
    {% endcompress %}

  {% if rrap_environment == "production" %}
    {% if google_analytics_ua %}
      <!-- Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id={{ google_analytics_ua }}"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ google_analytics_ua }}'{% if user.is_authenticated %}, {'user_id': '{{ user.pk }}'}{% endif %});
      </script>
    {% endif %}

    {% if sentry_dsn %}
      <!-- Sentry -->
      <script
        src="https://browser.sentry-cdn.com/6.12.0/bundle.tracing.min.js"
        integrity="sha384-rw3H9WWu9WpZYuqFa9AinpFrirprH4iUuo0HWGP2cjf0wZIa4wH+Wbo4vjkaH+bX"
        crossorigin="anonymous"
      ></script>
      <script>
        Sentry.init({
          dsn: "{{ sentry_dsn }}",
          release: "{{ rrap_version }}",
          environment: "{{ rrap_environment }}",
          integrations: [new Sentry.Integrations.BrowserTracing()],
          tracesSampleRate: 0.01
        });
      </script>
    {% endif %}
  {% endif %}

  </head>

  <body>

    <div class="be-wrapper be-nosidebar-left">
      <nav class="navbar navbar-expand fixed-top be-top-header">
        <div class="container-fluid">
          <div class="be-navbar-header"><a class="navbar-brand" href="{% url 'core:home' %}"></a></div>
          <div class="search-container">
            <div class="input-group input-group-sm">
              <input class="form-control search-input" type="text" name="search" placeholder="Search datasets">
            </div>
          </div>
          <a class="be-toggle-top-header-menu collapsed" href="#" data-toggle="collapse" aria-expanded="false" data-target="#be-navbar-collapse">Menu</a>
          <div class="navbar-collapse collapse" id="be-navbar-collapse">
            <ul class="navbar-nav">
              <li class="nav-item active">
                <a class="nav-link" href="{% url 'core:datasets' %}">DATASETS</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'core:locations' %}">LOCATIONS</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'core:organizations' %}">ORGANIZATIONS</a>
              </li>
              <li class="nav-item active">
                <a class="nav-link" href="{% url 'core:home' %}">TOPICS</a>
              </li>
              {% if request.user.is_authenticated %}
              <li class="nav-item">
                <a role="button" href="{% url 'users:organizations' user.username %}" class="nav-link btn btn-primary text-white">ADD DATA</a>
              </li>
              {% endif %}
            </ul>
          </div>

          <div class="be-right-navbar">
            {% if request.user.is_authenticated %}
            <ul class="nav navbar-nav float-right be-user-nav">
              <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-expanded="false"><img src="{% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}{% gravatar user=user %}{% endif %}" alt="Avatar"><span class="user-name">{% if user.profile.name %}{{ user.profile.name }}{% else %}{{ user.username}}{% endif %}</span></a>
                <div class="dropdown-menu" role="menu">     
                  <div class="user-info">
                    <div class="user-name">{% if user.profile.name %}{{ user.profile.name }}{% else %}{{ user.username }}{% endif %}</div>
                    <div class="user-position online">Online</div>
                  </div>
                  <a class="dropdown-item" href="{% url 'users:organizations' user.username %}">
                    <span class="icon mdi mdi-apps"></span>Your organizations
                  </a>
                  <a class="dropdown-item" href="{% url 'users:user_invites' user.username %}">
                    <span class="icon mdi mdi-email-open"></span>Your invitations {% if total_pending_invitations != 0 %}({{total_pending_invitations}}){% endif %}
                  </a>
                  <a class="dropdown-item" href="{% url 'users:detail' user.username  %}">
                    <span class="icon mdi mdi-face"></span>Profile
                  </a>
                  <a class="dropdown-item" href="{% url 'users:update_profile'  %}">
                    <span class="icon mdi mdi-settings"></span>Account Settings
                  </a>
                  <a class="dropdown-item" href="{% url 'account_logout' %}">
                    <span class="icon mdi mdi-power"></span>Logout
                  </a>
                </div>
              </li>
            </ul>
            <ul class="nav navbar-nav float-right be-icons-nav">
              <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-expanded="false"><span class="icon mdi mdi-notifications"></span>{% if total_pending_invitations != 0 %}<span class="indicator"></span>{% endif %}</a>
                <ul class="dropdown-menu be-notifications">
                  <li>
                    <div class="title">Invitations<span class="badge badge-pill">{{total_pending_invitations}}</span></div>
                    <div class="list">
                      <div class="be-scroller-notifications">
                        <div class="content">
                          <ul>
                            {% if pending_invitations %}
                            {% for invitation in pending_invitations %}
                            <li class="notification notification-unread">
                              <a href="{{ invitation.full_invitation_url }}">
                                <div class="notification-info">
                                  <div class="text"><span class="user-name">{{ invitation.invited_by.profile.name }}</span> invited you to collaborate on {{ invitation.organization.title }}.</div><span class="date">{{ invitation.date_sent|date:"SHORT_DATE_FORMAT" }}</span>
                                </div>
                              </a>
                            </li>
                              {% endfor %}
                              {% else %}
                              <li class="notification notification-unread">
                                <div class="notification-info">
                                  <div class="text p-3"><span class="user-name">You have no invitations at this time.</span></div>
                                </div>
                              </li>
                              {% endif %}
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="footer"> <a href="{% url 'users:user_invites' user.username %}">View all</a></div>
                  </li>
                  
                </ul>
              </li>
            </ul>
            {% else %}
            <ul class="nav navbar-nav float-right be-user-nav">
            {% if ACCOUNT_ALLOW_REGISTRATION %}
            <li class="nav-item">
              {# URL provided by django-allauth/account/urls.py #}
              <a id="sign-up-link" class="nav-link btn btn-secondary" href="{% url 'account_signup' %}" role="button" aria-expanded="false">{% translate "Sign Up" %}</a>
            </li>
            {% endif %}
              <li class="nav-item">
                {# URL provided by django-allauth/account/urls.py #}
                <a id="log-in-link" class="nav-link" href="{% url 'account_login' %}">{% translate "Sign In" %}</a>
              </li>
            {% endif %}
            </ul>
          </div>
        </div>
      </nav>

    <div class="be-content">
      
      <div class="container">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-icon alert-dismissible alert-icon-border {% if message.tags %}alert-{{ message.tags }}{% endif %}" role="alert">
            <button class="close" type="button" data-dismiss="alert" aria-label="Close"><span class="mdi mdi-close-circle-o" aria-hidden="true"></span></button>
            {% if message.tags == 'success' %}
            <div class="icon"><span class="mdi mdi-check"></span></div>
            {% elif message.tags == 'info' %}
            <div class="icon"><span class="mdi mdi-info-outline"></span></div>
            {% elif message.tags == 'error' or message.tags == 'danger' %}
            <div class="icon"><span class="mdi mdi-close-circle-o"></span></div>
            {% elif message.tags == 'warning' %}
            <div class="icon"><span class="mdi mdi-alert-triangle"></span></div>
            {% else %}
            <div class="icon"><span class="mdi mdi-notifications"></span></div>
            {% endif %}
            <div class="message">
            {{ message }}
            </div>
          </div>
        {% endfor %}
      {% endif %}

      {% block content %}
        <p>Use this document as a way to quick start any new project.</p>
      {% endblock content %}
      </div>
    </div>

    <footer class="be-footer">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-md-8">
            <ul class="nav">
              <li class="nav-item"><a class="nav-link text-secondary" href="/">v{{rrap_version}} ({{ rrap_environment }})</a></li>
              <li class="nav-item"><a class="nav-link text-secondary" href="#">Terms of service</a></li>
              <li class="nav-item"><a class="nav-link text-secondary" href="#">Privacy policy</a></li>
              <li class="nav-item"><a class="nav-link text-secondary" href="#">Help &amp; FAQs</a></li>
              <li class="nav-item"><a class="nav-link text-secondary" href="#">Contact us</a></li>
            </ul>
          </div>
          <div class="col-sm-12 col-md-4">
            <p class="footer-copyright text-secondary">&copy; 2022 Rapid Research for Agile Policymaking</p>
          </div>
        </div>
      </div>
    </footer>
  </div>

    {% block modal %}{% endblock modal %}

    {% block inline_javascript %}
    {% comment %}
    Script tags with only code, no src (defer by default). To run
    with a "defer" so that you run inline code:
    <script>
      window.addEventListener('DOMContentLoaded', () => {/* Run whatever you want */});
    </script>
    {% endcomment %}
    {% endblock inline_javascript %}
  </body>
</html>
