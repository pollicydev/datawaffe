{% extends 'base.html' %}

{% load compress i18n static crispy_forms_tags hitcount_tags social_share %}

{% block title %}{{ dataset.title }} Â· Rapid Research for Agile Policymaking {% endblock %}

{% block content %}

<div class="page-head">
  <nav aria-label="breadcrumb" role="navigation">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{% url 'core:home' %}">Home</a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'core:datasets' %}"><i class="breadcrumb-icon fa fa-angle-left"></i>Datasets</a>
      </li>
      <li class="breadcrumb-item active">
        <a href="{% url 'core:single_dataset' dataset.uuid  %}"><i
            class="breadcrumb-icon fa fa-angle-left"></i>{{ dataset.title }} </a>
      </li>
    </ol>
  </nav>

  <!-- dataset information -->
  <div class="row">
    <div class="col-md-9">
      {% if dataset.status == 0 %}
      <span style="display: inline-block;"
        class="badge badge-lg badge-dark mb-3">{{ dataset.get_status_display }}</span>
      {% endif %}
      <span class="d-flex">
        <img src="{% static dataset.get_icon %}" alt="{{ dataset.get_alt }}" height="30" />
        <h2 class="page-head-title mt-0 ml-1">
          {{ dataset.title }}</h2>
      </span>
      <p class="text-muted"> {{ dataset.summary }} </p>
      {% if dataset.file_url %}
      <a class="btn btn-space btn-dark btn-md" href="{{ dataset.file_url }}" download><i
          class="icon icon-left mdi mdi-cloud-download"></i>Download
        this dataset (PDF)</a>
      <p class="text-muted">Size: {{ dataset.get_file_size|filesizeformat }}</p>
      {% else %}
      <p class="text-muted">No file added</p>
      {% endif %}

      {% if request.user.is_authenticated and request.user == dataset.organization.owner or request.user in dataset.organization.members.all  %}
      <a href="{% url 'core:edit_data' dataset.uuid %}" class="btn btn-outline-secondary btn-space" role="button">Edit
        dataset</a>
      {% endif %}
    </div>
    <div class="col-md-3 logo">
      {% if dataset.organization.logo %}
      <a href="{% url 'core:single_org' dataset.organization.name %}">
        <img src="{{ dataset.organization.logo.url }}" alt="{{ dataset.organization.title }} logo" height="80" />
      </a>
      {% endif %}
    </div>
  </div>

  <!-- dataset toolbar -->
  <div class="row mt-4 mb-3">
    <div class="col-md-7 d-flex">
      {% if dataset.quality_confirmed %}
      <h5 class="mr-2 text-success"><i class="icon icon-left mdi mdi-badge-check"></i> Quality
        confirmed
      </h5>
      {% endif %}
      {% if dataset.has_microdata %}
      <h5 class="mr-2 text-info"><i class="icon icon-left mdi mdi-chart"></i> Contains microdata</h5>
      {% endif %}
      <h5 class="mr-2"><i class="icon icon-left mdi mdi-eye"></i> {% get_hit_count for dataset %}
        views</h5>
      <h5 class="mr-2"><i class="icon icon-left mdi mdi-cloud-download"></i> {{ dataset.download_count }}
        download{{ dataset.download_count|pluralize }}</h5>
      <h5 class="text-muted"><i class="icon icon-left mdi mdi-refresh"></i> Updates:
        {{ dataset.get_update_frequency_display }}</h5>
    </div>
    <div class="col-md-5">
      <p class="mb-2">
        <button class="btn btn-space btn-secondary"><i class="icon icon-left mdi mdi-comment-text"></i>Contact the
          contributor</button>
        {% post_to_facebook object_or_url "Facebook" %}
        {% post_to_twitter "{{dataset.title}}" object_or_url "Twitter" %}
        {% send_email object.title "{{self.title}}" object_or_url "Email" %}
        {% copy_to_clipboard object_or_url "Copy link" %}
      </p>
    </div>
  </div>
</div>

<div class="main-content container-fluid bg-white border-top">
  <div class="row">
    <div class="col-md-4 border-right">
      <div class="card">
        <div class="card-header">Activity stream</div>
        <div class="card-body">

        </div>
      </div>
    </div>
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">Resource & Metadata</div>
        <div class="card-body">
          <table class="table">
            <tbody>
              <tr>
                <td><b>Visibility</b></td>
                <td>{{ dataset.get_privacy_display }}</td>
              </tr>
              <tr>
                <td><b>Source</b></td>
                <td><a href="{% url 'core:single_org' dataset.organization.name %}">{{ dataset.organization.title }}</a>
                </td>
              </tr>
              <tr>
                <td><b>Date of dataset</b></td>
                <td>{{ dataset.start_date|date:"d F, Y" }} - {{ dataset.end_date|date:"d F, Y" }}
                </td>
              </tr>
              <tr>
                <td><b>Last updated</b></td>
                <td>{{ dataset.last_updated|date:"d F, Y" }}</td>
              </tr>
              <tr>
                <td><b>Expected updated frequency</b></td>
                <td>{{ dataset.get_update_frequency_display }}</td>
              </tr>
              <tr>
                <td><b>Data methodology</b></td>
                <td>{{ dataset.get_methodology_display }}</td>
              </tr>
              <tr>
                <td><b>Locations</b></td>
                <td>
                  {% for location in dataset.locations.all %}
                  <a href="{% url 'core:single_location' location.pk %}"
                    class="btn btn-rounded btn-space btn-secondary">{{ location }}</a>
                  {% endfor %}
                </td>
              </tr>
              <tr>
                <td><b>Topics</b></td>
                <td>
                  {{dataset.topics.all|join:", "}}
                </td>
              </tr>
              <tr>
                <td><b>Comments</b></td>
                <td>
                  <p>{{ dataset.caveats }}</p>
                </td>
              </tr>
              <tr>
                <td><b>Tags</b></td>
                <td>{{dataset.tags.all|join:", "}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %}
