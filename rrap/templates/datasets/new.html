{% extends 'base.html' %}

{% load static %}

{% block stylesheet %}
<link href="https://releases.transloadit.com/uppy/v3.0.1/uppy.min.css" rel="stylesheet">
{% endblock %}

{% block content %}

<input type="hidden" id="organization-id" value="{{ organization.id }}">

<div class="page-head">
  <nav aria-label="breadcrumb" role="navigation">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{% url 'core:home' %}">Home</a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'core:datasets' %}"><i class="breadcrumb-icon fa fa-angle-left"></i>Datasets</a>
      </li>
      <li class="breadcrumb-item active">
        <a href=""><i class="breadcrumb-icon fa fa-angle-left"></i>Add dataset</a>
      </li>
    </ol>
  </nav>
  <h2 class="page-head-title">Add dataset</h2>
</div>

<div class="main-content container-fluid">

  <div class="row">
    <div class="col-auto">
      <div id="drag-drop-area"></div>
    </div>
    <div class="col-4">
      <div class="card mb-3"><img class="card-img-top" src="assets/img/342x239.png" height="200" alt="Placeholder">
        <div class="card-body">
          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item"><b>Name:</b> </li>
            <li class="list-group-item"><b>Type:</b> </li>
            <li class="list-group-item"><b>Size:</b> </li>
          </ul>
          <a class="btn btn-secondary btn-sm btn-space" href="#"><i class="mdi mdi-eye"></i> Preview</a>
          <a class="btn btn-danger btn-sm btn-space" href="#"><i class="mdi mdi-delete"></i> Delete</a>
        </div>
        <div class="card-footer card-footer-contrast text-right"><a class="card-link btn btn-success btn-lg"
            href="#">Proceed to next step <i class="mdi mdi-arrow-right"></i></a></div>
      </div>
    </div>
  </div>
</div>

{% endblock content %}

{% block inline_javascript %}
<script type="module">
  import {Uppy, Dashboard, XHRUpload} from "https://releases.transloadit.com/uppy/v3.0.1/uppy.min.mjs"
  var uppy = new Uppy({
    id: 'uppy',
    autoProceed: true,
    restrictions: {
      maxFileSize: 25000000,
      minFileSize: null,
      maxTotalFileSize: null,
      maxNumberOfFiles: 1,
      minNumberOfFiles: 1,
      allowedFileTypes: null,
      meta: {
        organization_id: '{{ organization.id }}',
        organization: '{{ organization.title }}'
      }
    }
  })
    .use(Dashboard, {
      inline: true,
      target: '#drag-drop-area',
      height: 350,
    })
    .use(XHRUpload, {
      endpoint: "{% url 'data:upload' %}", 
      headers: {'X-CSRFToken': "{{ csrf_token }}"}, 
    })

  uppy.on('complete', (result) => {
    console.log('Upload complete! Weâ€™ve uploaded these files:', result.successful)
    // render uploaded file in table
    
  })
</script>
{% endblock %}
